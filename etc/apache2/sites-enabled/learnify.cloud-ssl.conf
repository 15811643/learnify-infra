<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName learnify.cloud
    ServerAlias www.learnify.cloud
    DocumentRoot /var/www/wp_stage

    # Security headers (adjust CSP later when you add scripts)
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

    # Moodle still served at /moodle by existing config/site
    # If Moodle is already configured as an Alias or Directory, leave it.
    # Optionally, forward /learn to /moodle:
    RedirectMatch ^/learn/?$ /moodle/

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/learnify_error.log
    CustomLog ${APACHE_LOG_DIR}/learnify_access.log combined

    SSLEngine on
    SSLCertificateFile      /etc/letsencrypt/live/learnify.cloud/fullchain.pem
    SSLCertificateKeyFile   /etc/letsencrypt/live/learnify.cloud/privkey.pem
    Include                 /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>

<Directory /var/www/wp_stage>
    Options FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>
Alias /moodle /var/www/moodle
<Directory /var/www/moodle>
    Options FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# --- learnify final security headers (override globals) ---
<IfModule mod_headers.c>
  Header always unset Referrer-Policy
  Header always unset X-Content-Type-Options
  Header always unset Permissions-Policy
  Header always unset Strict-Transport-Security

  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
</IfModule>
# --- end learnify headers ---
